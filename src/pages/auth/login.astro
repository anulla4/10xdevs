---
import Layout from '../../layouts/Layout.astro';
import { LoginForm } from '../../components/auth/LoginForm';

// Redirect to panel if already logged in
if (Astro.locals.user) {
  return Astro.redirect('/panel');
}

const redirectTo = Astro.url.searchParams.get('redirectTo') || '/panel';
const error = Astro.url.searchParams.get('error') || undefined;
const success = Astro.url.searchParams.get('success');

let successMessage: string | undefined;
if (success === 'password_changed') {
  successMessage = 'Hasło zostało zmienione. Możesz się teraz zalogować.';
} else if (success === 'email_confirmed') {
  successMessage = 'Twój adres e-mail został potwierdzony. Możesz się teraz zalogować.';
}
---

<Layout title="Logowanie - Nature Log">
  <div
    class="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 px-4 py-12"
  >
    <div class="w-full max-w-md">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Zaloguj się</h1>
        <p class="text-muted-foreground">Witaj ponownie w Nature Log</p>
      </div>

      <div class="bg-white dark:bg-gray-950 rounded-lg shadow-lg p-8 border border-gray-200 dark:border-gray-800">
        {
          successMessage && (
            <div class="mb-4 p-3 rounded-md bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 text-green-900 dark:text-green-100 text-sm">
              {successMessage}
            </div>
          )
        }
        <LoginForm client:load redirectTo={redirectTo} error={error} />
      </div>
    </div>
  </div>
</Layout>
